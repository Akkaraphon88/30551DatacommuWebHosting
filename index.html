<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resume — Akkaraphon Worakleeb</title>
  <meta name="description" content="Resume PDF viewer — Akkaraphon Worakleeb, Mathematics & Computer Science (Year 3)" />

  <!-- Tailwind CSS (แบบ CDN ใช้งานได้ทันที ไม่ต้อง build) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF.js (ตัวอ่าน PDF บนเว็บ) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    // บอก PDF.js ให้ใช้ worker จาก CDN (จำเป็นบน GitHub Pages)
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  </script>

  <style>
    /* เงานิ่ม ๆ ให้แผ่นกระดาษดูลอย */
    .page-shadow { box-shadow: 0 6px 16px rgba(17,17,23,.10); border-radius: .5rem; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">

  <!-- แถบเครื่องมือด้านบน: ใช้ flex ของ Tailwind -->
  <header class="sticky top-0 z-10 bg-white/95 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-3 flex flex-wrap items-center gap-2">
      <div class="font-bold tracking-wide text-rose-900">Resume PDF Viewer</div>
      <div class="ml-auto"></div>

      <!-- ปุ่มฟิตกว้าง/ฟิตหน้า -->
      <button id="fitWidthBtn" class="px-3 py-2 rounded-lg border border-slate-300 hover:border-slate-400">Fit Width</button>
      <button id="fitPageBtn"  class="px-3 py-2 rounded-lg border border-slate-300 hover:border-slate-400">Fit Page</button>

      <!-- ปุ่มซูม -->
      <button id="zoomOutBtn" class="px-3 py-2 rounded-lg border border-slate-300 hover:border-slate-400">−</button>
      <span id="zoomLabel" class="w-16 text-center font-semibold">100%</span>
      <button id="zoomInBtn" class="px-3 py-2 rounded-lg border border-slate-300 hover:border-slate-400">+</button>

      <!-- เปิด/ดาวน์โหลดไฟล์ -->
      <a id="openBtn"     href="#" target="_blank" rel="noopener"
         class="px-3 py-2 rounded-lg border border-slate-300 hover:border-slate-400">Open</a>
      <a id="downloadBtn" href="#" download
         class="px-3 py-2 rounded-lg bg-rose-900 text-white border border-rose-900 hover:bg-rose-800">Download</a>
    </div>
  </header>

  <!-- ตัว viewer: ใช้ max-width + center ด้วย Tailwind, สูงพอดีจอด้วย calc -->
  <main class="max-w-6xl mx-auto px-3">
    <!-- กล่องครอบ viewer -->
    <section class="mt-4 bg-white border border-slate-200 rounded-xl overflow-hidden">
      <!-- พื้นที่เลื่อนดู PDF (สูงพอดีหน้าจอ) -->
      <div id="viewer"
           class="overflow-auto bg-slate-100 flex justify-center"
           style="height: calc(100vh - 120px);">
        <!-- ข้อความตอนกำลังโหลด -->
        <div id="loadingMsg" class="p-6 text-slate-500">กำลังโหลดไฟล์…</div>
      </div>
    </section>

    <p class="text-center text-slate-500 text-sm my-6">
      เว็บไซต์: <a class="underline" href="https://akkaraphon88.github.io/30551DatacommuWebHosting" target="_blank" rel="noopener">
      akkaraphon88.github.io/30551DatacommuWebHosting</a>
    </p>
  </main>

  <script>
    /**********************************************************************
     * โค้ดด้านล่างนี้เป็น "ภาษาบ้าน ๆ" อธิบายไปด้วยในคอมเมนต์
     **********************************************************************/

    // 1) ตั้งชื่อไฟล์ PDF ที่อยู่ "โฟลเดอร์เดียวกับไฟล์ index.html"
    //    >> ต้องตรงตัวพิมพ์เล็ก-ใหญ่เป๊ะ ๆ <<
    const PDF_FILE = "resumeAkkaphonWorakleeb30551.pdf";

    // 2) ตัวแปรหลักของ viewer
    let pdfDoc = null;        // เอกสาร PDF ทั้งเล่ม
    let scale = 1;            // อัตราซูมปัจจุบัน (1 = 100%)
    let baseViewport = null;  // ขนาดหน้าเมื่อ scale = 1 (ไว้คำนวณ fit)
    let fitMode = "width";    // โหมดเริ่มต้น: "width" (ฟิตกว้าง) | "page" | "free"

    // 3) อ้างถึง element ที่เราจะใช้
    const viewer      = document.getElementById("viewer");
    const loadingMsg  = document.getElementById("loadingMsg");
    const zoomLabel   = document.getElementById("zoomLabel");
    const fitWidthBtn = document.getElementById("fitWidthBtn");
    const fitPageBtn  = document.getElementById("fitPageBtn");
    const zoomInBtn   = document.getElementById("zoomInBtn");
    const zoomOutBtn  = document.getElementById("zoomOutBtn");
    const openBtn     = document.getElementById("openBtn");
    const downloadBtn = document.getElementById("downloadBtn");

    // ใส่ลิงก์ Open/Download ให้ปุ่มทำงาน
    openBtn.href     = PDF_FILE;
    downloadBtn.href = PDF_FILE;

    // 4) ฟังก์ชันช่วยแปะตัวเลข %
    function updateZoomLabel() {
      zoomLabel.textContent = Math.round(scale * 100) + "%";
    }

    // 5) โหมดฟิตกว้าง: ให้หน้ากระดาษกว้างพอดีกับพื้นที่เลื่อน (viewer)
    function fitWidth() {
      const padding = 40; // เว้นขอบซ้ายขวาเล็กน้อย (กันคอนเทนต์ชิดขอบ)
      const availableW = viewer.clientWidth - padding;
      scale = availableW / baseViewport.width;
      fitMode = "width";
      updateZoomLabel();
    }

    // 6) โหมดฟิตหน้า: ให้ทั้งหน้าอยู่ในจอ (แต่ถ้าหน้ากว้างมากก็จะเล็กลง)
    function fitPage() {
      const padding = 40;
      const availableW = viewer.clientWidth  - padding;
      const availableH = viewer.clientHeight - padding;
      const s1 = availableW / baseViewport.width;
      const s2 = availableH / baseViewport.height;
      scale = Math.min(s1, s2);
      fitMode = "page";
      updateZoomLabel();
    }

    // 7) ซูมลื่น ๆ: คูณ/หาร scale ด้วย factor (จำกัด max/min)
    function zoomBy(factor) {
      fitMode = "free"; // พอซูมด้วยมือ เราถือว่าเป็นโหมดอิสระ
      const newScale = Math.min(3.5, Math.max(0.5, scale * factor)); // 50%–350%
      if (Math.abs(newScale - scale) < 0.02) return; // ถ้าต่างนิดเดียว ไม่ต้อง re-render
      scale = newScale;
      updateZoomLabel();
      renderAllPages(); // วาดใหม่ให้คมชัดตามซูม
    }

    // 8) วาดทุกหน้า: ใช้ canvas ต่อหนึ่งหน้า ปรับความคมตาม devicePixelRatio
    async function renderAllPages() {
      viewer.innerHTML = ""; // ล้างก่อนทุกครั้ง
      const dpr = window.devicePixelRatio || 1; // จอ Retina จะ > 1
      const total = pdfDoc.numPages;

      for (let n = 1; n <= total; n++) {
        const page = await pdfDoc.getPage(n);
        const viewport = page.getViewport({ scale });

        // สร้าง canvas สำหรับหน้านี้
        const canvas = document.createElement("canvas");
        canvas.className = "page-shadow my-5 bg-white";
        const ctx = canvas.getContext("2d");

        // คูณด้วย dpr เพื่อให้คมชัด (ไม่เบลอ)
        canvas.width  = Math.floor(viewport.width  * dpr);
        canvas.height = Math.floor(viewport.height * dpr);
        canvas.style.width  = Math.floor(viewport.width)  + "px";
        canvas.style.height = Math.floor(viewport.height) + "px";

        // บอก PDF.js ให้เรนเดอร์เข้ากับ scale ของ dpr
        const renderContext = {
          canvasContext: ctx,
          viewport: viewport,
          transform: dpr !== 1 ? [dpr, 0, 0, dpr, 0, 0] : null
        };

        viewer.appendChild(canvas);
        await page.render(renderContext).promise;
      }

      // หลังวาดใหม่ เลื่อนกลับบนสุด เพื่อไม่ให้ผู้ใช้ งง
      viewer.scrollTo({ top: 0, behavior: "instant" });
    }

    // 9) โหลดไฟล์ PDF แล้วแสดงทันทีที่เปิดเว็บ
    (async () => {
      try {
        const pdfLoadingTask = pdfjsLib.getDocument(PDF_FILE);
        pdfDoc = await pdfLoadingTask.promise;

        // เตรียม baseViewport จากหน้าแรก (ใช้ scale = 1)
        const first = await pdfDoc.getPage(1);
        baseViewport = first.getViewport({ scale: 1 });

        // เริ่มต้นด้วยโหมด "ฟิตกว้าง" จะอ่านเต็มตา
        fitWidth();
        await renderAllPages();

        // ปิดข้อความกำลังโหลด
        if (loadingMsg) loadingMsg.remove();
      } catch (err) {
        viewer.innerHTML =
          `<div class="p-6 text-red-700">ไม่สามารถเปิดไฟล์ได้: <span class="font-semibold">${err.message}</span><br>
             ตรวจสอบว่าชื่อไฟล์ <code>${PDF_FILE}</code> ตรงกับไฟล์ใน repo แบบตัวพิมพ์เล็ก-ใหญ่หรือไม่</div>`;
      }
    })();

    // 10) ลิงก์ปุ่ม & คีย์ลัด
    fitWidthBtn.addEventListener("click", () => { fitWidth(); renderAllPages(); });
    fitPageBtn .addEventListener("click", () => { fitPage();  renderAllPages(); });
    zoomInBtn  .addEventListener("click", () => zoomBy(1.1));
    zoomOutBtn .addEventListener("click", () => zoomBy(1/1.1));

    // คีย์ลัดยอดนิยม: Ctrl/⌘ + , Ctrl/⌘ -, Ctrl/⌘ 0, W, P
    window.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && (e.key === "+" || e.key === "=")) { e.preventDefault(); zoomBy(1.1); }
      if ((e.ctrlKey || e.metaKey) &&  e.key === "-")                   { e.preventDefault(); zoomBy(1/1.1); }
      if ((e.ctrlKey || e.metaKey) &&  e.key === "0")                   { e.preventDefault(); fitWidth(); renderAllPages(); }
      if (e.key.toLowerCase() === "w") { fitWidth(); renderAllPages(); }
      if (e.key.toLowerCase() === "p") { fitPage();  renderAllPages(); }
    });

    // 11) เวลาเปลี่ยนขนาดหน้าต่าง ถ้าอยู่โหมด fit ให้คงความพอดีไว้
    let resizeTimer;
    window.addEventListener("resize", () => {
      if (fitMode !== "free") {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          (fitMode === "width" ? fitWidth : fitPage)();
          renderAllPages();
        }, 120); // หน่วงนิดนึงให้ลื่น
      }
    });
  </script>

  <noscript>
    <div class="max-w-3xl mx-auto my-6 p-4 bg-yellow-50 border border-yellow-300 rounded">
      ต้องเปิดใช้งาน JavaScript เพื่อดูตัวอ่าน PDF แบบโต้ตอบ
      <div>สำรอง: <a class="underline" href="resumeAkkaphonWorakleeb30551.pdf" target="_blank" rel="noopener">เปิดไฟล์ PDF ในแท็บใหม่</a></div>
    </div>
  </noscript>
</body>
</html>
