<!doctype html> <!-- นี่คือ HTML5 นะเว้ย -->
<html lang="th"> 
<head>
  <meta charset="utf-8" />
  <!-- meta viewport: ปิดการซูมทั้งหน้า (user-scalable=no) กันชนกับ pinch ภายใน viewer -->
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <title>Resume — Akkaraphon Worakleeb</title>

  <!-- ==== SEO/พรีวิวลิงก์ ปล.ขึ้นรายละเอียดในลิ้ง ==== -->
  <meta name="description" content="เรซูเม่ Akkaraphon Worakleeb — KMUTNB | Reseme ของนายอัครพนธ์คนระยองครับ PDF On Web ">
  <link rel="canonical" href="https://akkaraphon88.github.io/30551DatacommuWebHosting/">

  <!-- Open Graph (ตอนแชร์ลงต่างๆ ทำไว้) -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Resume — Akkaraphon Worakleeb">
  <meta property="og:url" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/">
  <meta property="og:title" content="Resume — Akkaraphon Worakleeb (KMUTNB)">
  <meta property="og:description" content="Reseme ของนายอัครพนธ์คนระยองครับ PDF On Web ">
  <meta property="og:image" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/resumeAkkaphonWorakleeb30551.png">
  <meta property="og:image:width" content="1200"><meta property="og:image:height" content="630">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Resume — Akkaraphon Worakleeb (KMUTNB)">
  <meta name="twitter:description" content="Reseme ของนายอัครพนธ์คนระยองครับ PDF On Web ">
  <meta name="twitter:image" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/resumeAkkaphonWorakleeb30551.png">

  <!-- ธีมสี + ไอคอนเว็บ -->
  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#6b0f0f">
  <link rel="icon" type="image/png" href="favicon.png">      
  <link rel="apple-touch-icon" href="favicon.png">

  <!-- Tailwind CDN: ใช้คลาสได้เลย -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF.js (ตัวอ่าน PDF ฝั่ง client) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    // ชี้ไฟล์ worker ของ PDF.js (สำคัญเวลาโฮสต์บน GitHub Pages)
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  </script>

  <style>
    /* ให้แผ่นกระดาษดูเป็นกระดาษจริงนิดหน่อย */
    .page-shadow { box-shadow: 0 10px 22px rgba(2, 6, 23, .12); border-radius: .6rem; }
    /* แต่งสกอลบาร์ให้สะอาดตา (Chrome/Safari) */
    #viewer::-webkit-scrollbar{height:12px;width:12px}
    #viewer::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:999px}
    #viewer::-webkit-scrollbar-track{background:#e2e8f0}
    /* กันหน้าเว็บ “เด้ง” ตอนลากสุด */
    #viewer{ overscroll-behavior: contain; }
    /* เคล็ดลับความลื่น: บอกเบราว์เซอร์ว่าตัวนี้จะโดน transform บ่อย → สร้างเลเยอร์แยกให้ */
    .gpu { will-change: transform; transform: translateZ(0); }
  </style>
</head>

<body class="bg-slate-50 text-slate-800 antialiased selection:bg-rose-100">

  <!-- ====== TOOLBAR ด้านบน ====== -->
  <header class="sticky top-0 z-20 bg-white/95 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-3 sm:px-4 py-2.5 flex flex-wrap items-center gap-2">
      <!-- ปุ่มชื่อแบรนด์: คลิก = รีหน้าใหม่ (ง่ายๆ) -->
      <button id="brandBtn" class="flex items-center gap-2 mr-auto select-none" title="รีหน้าเว็บ">
        <span class="inline-block h-6 w-1.5 bg-rose-900 rounded"></span>
        <span class="font-bold tracking-wide text-rose-900">Resume อัครพนธ์</span>
      </button>

      <!-- ปุ่มซูมพื้นฐาน -->
      <button id="zoomOutBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">−</button>
      <span id="zoomLabel" class="w-16 text-center font-semibold tabular-nums">100%</span>
      <button id="zoomInBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">+</button>

      <span class="mx-1 w-px h-6 bg-slate-200"></span>

      <!-- ปุ่มเปิด/ดาวน์โหลด -->
      <a id="openBtn" href="#" target="_blank" rel="noopener"
         class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">OpenPDF</a>
      <a id="downloadBtn" href="#" download
         class="px-3 py-1.5 rounded-lg bg-rose-900 text-white border border-rose-900 hover:bg-rose-800">Download</a>
    </div>

    <!-- แถบสถานะโหลด PDF -->
    <div id="progressWrap" class="w-full h-1 bg-slate-200">
      <div id="progressBar" class="h-full w-0 bg-rose-900 transition-all duration-300"></div>
    </div>
  </header>

  <!-- ====== VIEWER พื้นที่แสดง PDF ====== -->
  <main class="max-w-6xl mx-auto px-3 sm:px-4">
    <section class="mt-4 bg-white border border-slate-200 rounded-xl overflow-hidden">
      <!-- สูงพอดีตา: หักพื้นที่ toolbar -->
      <div id="viewer"
           class="overflow-auto bg-slate-100 flex justify-center"
           style="height: calc(100vh - 128px); touch-action: pan-y;">
        <!-- หมายเหตุ touch-action: pan-y = เลื่อนแนวตั้งได้ แต่ซูม 2 นิ้วเราคุมเอง -->
        <div id="pageWrap" class="my-5"> <!-- ห่อ canvas เพื่อไว้ทำ transform ตอนซูมสด -->
          <canvas id="pageCanvas" class="page-shadow bg-white mx-auto block gpu"></canvas>
        </div>
        <div id="loadingMsg" class="absolute p-6 text-slate-500">กำลังโหลดไฟล์ครับ...</div>
      </div>
    </section>

    <footer class="text-center text-slate-500 text-sm my-6">
      เว็บไซต์:
      <a class="underline" href="https://akkaraphon88.github.io/30551DatacommuWebHosting" target="_blank" rel="noopener">
        akkaraphon88.github.io/30551DatacommuWebHosting
      </a>
    </footer>
  </main>

  <script>
    /* ================================================================
       ฟังชั่นที่เขียนไป
       - ใช้ “ซูม 2 จังหวะ” เพื่อให้สมูท: ตอนกำลังซูม → transform (ลื่น)
         พอปล่อย/หยุด 120ms → ค่อยเรนเดอร์จริงที่สเกลใหม่ (คม)
       - แก้ไฟล์กลับหัวด้วย rotation: 0
       - จำกัด dpr สูงสุด 2 กัน iOS ช้า/กินแรม
       - ยกเลิกงานเรนเดอร์เก่าถ้ากดซูมรัวๆ (ไม่ให้ค้าง)
       ================================================================ */

    /* ===== 1) ตั้งชื่อไฟล์ PDF (อยู่โฟลเดอร์เดียวกับ index.html) ===== */
    const PDF_FILE_LOWER = "resumeAkkaphonWorakleeb30551.pdf";
    const PDF_FILE_UPPER = "resumeAkkaphonWorakleeb30551.PDF";
    let   PDF_FILE       = PDF_FILE_LOWER;

    /* ===== 2) ตัวแปรหลักของ viewer ===== */
    let pdfDoc = null;          // ตัวเอกสาร PDF
    let baseViewport = null;    // ขนาดหน้าแรกตอน scale=1 (ใช้คำนวณฟิต)
    let renderScale = 1;        // สเกลที่วาด “จริง” (คม)
    let cssScale    = 1;        // สเกลที่ขยายด้วย CSS ชั่วคราว (ลื่น)
    let renderTask  = null;     // งานเรนเดอร์ปัจจุบัน (ยกเลิกได้)
    let settleTimer = null;     // ตัวจับเวลา 120ms หลังซูมหยุด
    const DPR = Math.min(window.devicePixelRatio || 1, 2); // dpr สูงสุด 2

    /* ===== 3) element อ้างอิง ===== */
    const viewer       = document.getElementById("viewer");
    const pageWrap     = document.getElementById("pageWrap");   // ห่อ canvas ไว้ transform
    const canvas       = document.getElementById("pageCanvas");
    const ctx          = canvas.getContext("2d");
    const loadingMsg   = document.getElementById("loadingMsg");
    const progressBar  = document.getElementById("progressBar");
    const progressWrap = document.getElementById("progressWrap");
    const brandBtn     = document.getElementById("brandBtn");
    const zoomInBtn    = document.getElementById("zoomInBtn");
    const zoomOutBtn   = document.getElementById("zoomOutBtn");
    const zoomLabel    = document.getElementById("zoomLabel");
    const openBtn      = document.getElementById("openBtn");
    const downloadBtn  = document.getElementById("downloadBtn");

    /* ===== 4) ปุ่มลิงก์ไฟล์ ===== */
    function wireFileButtons(){ openBtn.href = downloadBtn.href = PDF_FILE; }

    /* ===== 5) โชว์เปอร์เซ็นต์ซูม (ใช้สเกลรวม = renderScale * cssScale) ===== */
    function updateZoomLabel(){
      const pct = Math.round(renderScale * cssScale * 100);
      zoomLabel.textContent = pct + "%";
    }

    /* ===== 6) คำนวณให้ “พอดีกว้าง” แล้ววาดจริง ===== */
    function fitWidth(){
      const padding = 40; // กันชิดขอบ
      const availableW = viewer.clientWidth - padding;
      renderScale = availableW / baseViewport.width;
      cssScale = 1;                       // รี css zoom กลับมา 1
      pageWrap.style.transform = "";      // ลบ transform ออก
      updateZoomLabel();
      renderAt(renderScale);              // วาดใหม่ที่สเกลนี้
    }

    /* ===== 7) ฟังก์ชันวาดจริง (คม) พร้อมยกเลิกงานเก่าถ้ามี ===== */
    async function renderAt(scale){
      // ถ้ามีงานวาดค้างอยู่ ให้ยกเลิก (กันหน่วง/แกว่ง)
      if (renderTask && renderTask.cancel) { try { renderTask.cancel(); } catch {} }
      // viewport ใหม่ (หมุน 0 องศา แก้กลับหัว)
      const vp = baseViewport.clone({ scale, rotation: 0 });

      // ตั้งขนาด canvas จริง = ขนาดพิกเซล * DPR (คม)
      canvas.width  = Math.floor(vp.width  * DPR);
      canvas.height = Math.floor(vp.height * DPR);
      // ขนาดที่เห็นบนจอ (CSS pixel)
      canvas.style.width  = Math.floor(vp.width)  + "px";
      canvas.style.height = Math.floor(vp.height) + "px";

      // ดึงหน้าที่ 1 (เรซูเม่ส่วนใหญ่หน้าเดียว)
      const page = await pdfDoc.getPage(1);

      // ให้ PDF.js วาดลง canvas (ชดเชย DPR)
      renderTask = page.render({
        canvasContext: ctx,
        viewport: vp,
        transform: DPR !== 1 ? [DPR, 0, 0, DPR, 0, 0] : null
      });

      try { await renderTask.promise; } catch(e){ /* ถ้าถูก cancel ก็ผ่านไป */ }
    }

    /* ===== 8) “ซูมลื่น” = แค่เปลี่ยน CSS ก่อน แล้วหน่วง 120ms ค่อยวาดจริง ===== */
    function smoothZoomBy(factor){
      // ขั้น 1: อัปเดต cssScale (ลื่นทันที)
      cssScale = Math.min(4 / renderScale, Math.max(0.4 / renderScale, cssScale * factor));
      pageWrap.style.transformOrigin = "center top";
      pageWrap.style.transform = `scale(${cssScale})`;
      updateZoomLabel();

      // ขั้น 2: ถ้าไม่มีการซูมซ้ำใน 120ms → วาดจริงที่สเกลรวมใหม่
      clearTimeout(settleTimer);
      settleTimer = setTimeout(()=>{
        renderScale = Math.min(4, Math.max(0.4, renderScale * cssScale));
        cssScale = 1;
        pageWrap.style.transform = "";
        updateZoomLabel();
        renderAt(renderScale);
      }, 120);
    }

    /* ===== 9) โหลด PDF (ถ้า .pdf ไม่เจอ ลอง .PDF ต่อให้) ===== */
    async function loadPdf(){
      wireFileButtons();

      const task = pdfjsLib.getDocument({
        url: PDF_FILE,
        disableAutoFetch: true,      // ไม่ดูดทุกหน้า (เราใช้หน้าเดียว)
        rangeChunkSize: 65536
      });

      task.onProgress = ({loaded,total})=>{
        if (total) progressBar.style.width = Math.min(100, Math.round(loaded/total*100)) + "%";
      };

      try{
        pdfDoc = await task.promise;
      }catch(err){
        if (PDF_FILE === PDF_FILE_LOWER){
          PDF_FILE = PDF_FILE_UPPER; wireFileButtons(); return loadPdf();
        }
        throw err;
      }

      // เตรียม viewport ฐานจากหน้าแรก (scale=1, หมุน 0)
      const first = await pdfDoc.getPage(1);
      baseViewport = first.getViewport({ scale: 1, rotation: 0 });

      // เริ่มด้วย “ฟิตกว้าง” แล้ววาดจริง
      fitWidth();

      // เก็บกวาด UI โหลด
      loadingMsg?.remove();
      setTimeout(()=>progressWrap.classList.add("hidden"), 400);
    }

    // ยิงโหลดเลย
    loadPdf().catch(err=>{
      progressWrap.classList.add("hidden");
      viewer.innerHTML = `<div class="p-6 text-red-700">
        ไม่สามารถเปิดไฟล์ได้: <b>${err.message}</b><br>
        ตรวจชื่อไฟล์ <code>${PDF_FILE}</code> ให้ตรงกับใน repo (คำนึงตัวพิมพ์เล็ก/ใหญ่)
      </div>`;
    });

    /* ===== 10) ปุ่ม/คีย์ลัด/เมาส์ ===== */
    brandBtn.addEventListener("click", () => location.reload());  // คลิกชื่อ = รีหน้าใหม่
    zoomInBtn .addEventListener("click", () => smoothZoomBy(1.1));
    zoomOutBtn.addEventListener("click", () => smoothZoomBy(1/1.1));

    // Ctrl + ล้อเมาส์ = ซูม (แบบมืออาชีพ)
    viewer.addEventListener("wheel", (e)=>{
      if (e.ctrlKey) { e.preventDefault(); smoothZoomBy(e.deltaY < 0 ? 1.08 : 1/1.08); }
    }, { passive:false });

    // คีย์ลัดเบสิก (+, -, 0)
    window.addEventListener("keydown",(e)=>{
      if ((e.ctrlKey||e.metaKey) && (e.key==='+' || e.key==='=')) { e.preventDefault(); smoothZoomBy(1.1); }
      if ((e.ctrlKey||e.metaKey) &&  e.key==='-')                 { e.preventDefault(); smoothZoomBy(1/1.1); }
      if ((e.ctrlKey||e.metaKey) &&  e.key==='0')                 { e.preventDefault(); fitWidth(); }
    });

    /* ===== 11) Pinch-to-Zoom บนมือถือ/แท็บเล็ต (สองนิ้วหนีบ/กาง) =====
       ทำงานเหมือนปุ่มซูม: ตอนหนีบ/กาง → เปลี่ยน cssScale (ลื่น)
       ปล่อยนิ้ว → เรนเดอร์จริงที่สเกลใหม่ (คม) */
    const touches = new Map();  // เก็บตำแหน่งนิ้วที่แตะอยู่
    let pinchBaseDist = null, pinchStartCss = 1;

    function dist(a,b){ return Math.hypot(a.x-b.x, a.y-b.y); }

    viewer.addEventListener("pointerdown",(e)=>{
      viewer.setPointerCapture(e.pointerId);
      touches.set(e.pointerId, { x: e.clientX, y: e.clientY });
    }, { passive:true });

    viewer.addEventListener("pointermove",(e)=>{
      if (!touches.has(e.pointerId)) return;
      touches.set(e.pointerId, { x: e.clientX, y: e.clientY });

      if (touches.size === 2){
        const [a,b] = [...touches.values()];
        const d = dist(a,b);
        if (!pinchBaseDist){
          pinchBaseDist = d;        // เริ่ม pinch → จำระยะเริ่ม
          pinchStartCss = cssScale; // จำ cssScale ตอนเริ่ม
        }else{
          const factor = d / pinchBaseDist;
          // อัปเดต cssScale แบบ “สด” เพื่อความลื่น
          cssScale = Math.min(4 / renderScale, Math.max(0.4 / renderScale, pinchStartCss * factor));
          pageWrap.style.transformOrigin = "center top";
          pageWrap.style.transform = `scale(${cssScale})`;
          updateZoomLabel();

          // ตั้ง settleTimer ใหม่ทุกครั้ง (ปล่อยนิ้วค่อยวาดจริง)
          clearTimeout(settleTimer);
          settleTimer = setTimeout(()=>{
            renderScale = Math.min(4, Math.max(0.4, renderScale * cssScale));
            cssScale = 1;
            pageWrap.style.transform = "";
            updateZoomLabel();
            renderAt(renderScale);
          }, 120);
        }
        e.preventDefault(); // กัน iOS ซูมทั้งหน้า
      }
    }, { passive:false });

    function endPointer(e){
      touches.delete(e.pointerId);
      if (touches.size < 2) { pinchBaseDist = null; }
    }
    viewer.addEventListener("pointerup", endPointer, { passive:true });
    viewer.addEventListener("pointercancel", endPointer, { passive:true });
    viewer.addEventListener("pointerleave", endPointer, { passive:true });

    /* ===== 12) รีไซซ์หน้าจอ: คง “ฟิตกว้าง” ไว้ ===== */
    let resizeTimer;
    window.addEventListener("resize", ()=>{
      if (!baseViewport) return;
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(()=>{ fitWidth(); }, 120);
    });
  </script>

  <!-- เผื่อคนปิด JS → ให้ลิงก์สำรองเปิด PDF ได้ -->
  <noscript>
    <div class="max-w-3xl mx-auto my-6 p-4 bg-yellow-50 border border-yellow-300 rounded">
      ต้องเปิดใช้งาน JavaScript เพื่อดูตัวอ่าน PDF แบบโต้ตอบ
      <div>สำรอง: <a class="underline" href="resumeAkkaphonWorakleeb30551.pdf" target="_blank" rel="noopener">
        เปิดไฟล์ PDF ในแท็บใหม่</a></div>
    </div>
  </noscript>
</body>
</html>
