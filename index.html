<!doctype html> <!-- โหมด HTML5 -->
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resume — Akkaraphon Worakleeb</title>

  <!-- ===== META สำหรับพรีวิวลิงก์/SEO แบบสั้นๆ ===== -->
  <meta name="description" content="เรซูเม่ Akkaraphon Worakleeb — KMUTNB | เปิดปุ๊บเห็นเลย ซูมลื่น คม ดาวน์โหลดได้">
  <link rel="canonical" href="https://akkaraphon88.github.io/30551DatacommuWebHosting/">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Resume — Akkaraphon Worakleeb">
  <meta property="og:url" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/">
  <meta property="og:title" content="Resume — Akkaraphon Worakleeb (KMUTNB)">
  <meta property="og:description" content="เปิดดู PDF ได้ทันที ซูมลื่น คม">
  <meta property="og:image" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/resumeAkkaphonWorakleeb30551.png">
  <meta property="og:image:width" content="1200"><meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">

  <!-- ธีมสี + Favicon (แน่ใจว่าใส่ไฟล์ favicon.png แล้ว) -->
  <meta name="color-scheme" content="light"><meta name="theme-color" content="#6b0f0f">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="favicon.png">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    // บอก PDF.js ให้ใช้ worker จาก CDN (จำเป็นบน GitHub Pages)
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  </script>

  <!-- แต่งหน้ากระดาษ + สกอลบาร์ -->
  <style>
    .page-shadow{ box-shadow:0 10px 22px rgba(2,6,23,.12); border-radius:.6rem; }
    #viewer::-webkit-scrollbar{height:12px;width:12px}
    #viewer::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:999px}
    #viewer::-webkit-scrollbar-track{background:#e2e8f0}

    /* กล่องนี้ไว้ “ขยาย-ย่อ แบบเรียลไทม์” ด้วย CSS transform */
    #pageScale {
      transform-origin: top center; /* ซูมแล้วไม่หนีศูนย์ */
      will-change: transform;       /* 힌ต์ให้เบราว์เซอร์เร่ง HW */
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased selection:bg-rose-100">

  <!-- ===== Toolbar ===== -->
  <header class="sticky top-0 z-20 bg-white/95 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-3 sm:px-4 py-2.5 flex flex-wrap items-center gap-2">
      <!-- ปุ่มซ้าย: คลิกแล้วรีหน้า -->
      <button id="brandBtn" class="flex items-center gap-2 mr-auto select-none" title="รีหน้าเว็บ">
        <span class="inline-block h-6 w-1.5 bg-rose-900 rounded"></span>
        <span class="font-bold tracking-wide text-rose-900">Resume อัครพนธ์</span>
      </button>

      <!-- ซูม +/− -->
      <button id="zoomOutBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">−</button>
      <span id="zoomLabel" class="w-16 text-center font-semibold tabular-nums">100%</span>
      <button id="zoomInBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">+</button>

      <span class="mx-1 w-px h-6 bg-slate-200"></span>

      <!-- Open/Download -->
      <a id="openBtn" href="#" target="_blank" rel="noopener"
         class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">Open</a>
      <a id="downloadBtn" href="#" download
         class="px-3 py-1.5 rounded-lg bg-rose-900 text-white border border-rose-900 hover:bg-rose-800">Download</a>
    </div>

    <!-- แถบโหลด -->
    <div id="progressWrap" class="w-full h-1 bg-slate-200">
      <div id="progressBar" class="h-full w-0 bg-rose-900 transition-all duration-300"></div>
    </div>
  </header>

  <!-- ===== Viewer ===== -->
  <main class="max-w-6xl mx-auto px-3 sm:px-4">
    <section class="mt-4 bg-white border border-slate-200 rounded-xl overflow-hidden">
      <!-- สูงพอดีตา; touch-action: pan-y = เลื่อนแนวตั้งได้ (เราจะจับ pinch เอง) -->
      <div id="viewer" class="overflow-auto bg-slate-100 flex justify-center"
           style="height: calc(100vh - 128px); touch-action: pan-y;">
        <!-- pageScale: ห่อทุกหน้าไว้เพื่อ scale ด้วย CSS แบบสด -->
        <div id="pageScale">
          <div id="loadingMsg" class="p-6 text-slate-500">กำลังโหลดไฟล์ครับ...</div>
        </div>
      </div>
    </section>

    <footer class="text-center text-slate-500 text-sm my-6">
      เว็บไซต์:
      <a class="underline" href="https://akkaraphon88.github.io/30551DatacommuWebHosting" target="_blank" rel="noopener">
        akkaraphon88.github.io/30551DatacommuWebHosting
      </a>
    </footer>
  </main>

  <script>
    /* ========================= อธิบายแบบบ้านๆ สั้น กระชับ =========================
       - เปิดเว็บแล้วโหลด PDF ทันที → วาง <canvas> ทีละหน้า
       - บังคับ rotation:0 กันกลับหัว
       - ซูม 2 ขั้นตอน:
           1) หนีบ/กาง หรือกด +/− → ใช้ CSS transform กับ #pageScale (ลื่น)
           2) พอหยุด 120ms → re-render ด้วย PDF.js ที่ scale ใหม่ (คม)
       - คลิกชื่อ “Resume อัครพนธ์” = รีหน้า
       ========================================================================= */

    // ---------- ตั้งชื่อไฟล์ PDF (ต้องอยู่โฟลเดอร์เดียวกับ index.html) ----------
    const PDF_FILE_LOWER = "resumeAkkaphonWorakleeb30551.pdf";
    const PDF_FILE_UPPER = "resumeAkkaphonWorakleeb30551.PDF";
    let PDF_FILE = PDF_FILE_LOWER;

    // ---------- ตัวแปรหลัก ----------
    let pdfDoc = null;              // เอกสาร PDF
    let renderScale = 1;            // scale ที่ "วาดจริง" บน canvas
    let viewScale   = 1;            // scale ที่ "โชว์สด" ด้วย CSS transform (ลื่น)
    const MIN = 0.4, MAX = 4;       // ขอบเขตซูม
    let baseViewport = null;        // viewport หน้าแรกตอน scale=1

    // ---------- element ----------
    const viewer      = document.getElementById('viewer');
    const pageScaleEl = document.getElementById('pageScale');
    const loadingMsg  = document.getElementById('loadingMsg');
    const progressBar = document.getElementById('progressBar');
    const progressWrap= document.getElementById('progressWrap');
    const zoomInBtn   = document.getElementById('zoomInBtn');
    const zoomOutBtn  = document.getElementById('zoomOutBtn');
    const zoomLabel   = document.getElementById('zoomLabel');
    const brandBtn    = document.getElementById('brandBtn');
    const openBtn     = document.getElementById('openBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    // ปุ่มไฟล์ให้ชี้ถูกตัว
    function wireFileButtons(){ openBtn.href = downloadBtn.href = PDF_FILE; }

    // โชว์ % ซูม
    const showZoom = () => zoomLabel.textContent = Math.round(viewScale*100) + '%';

    // ฟิตกว้างตอนเปิดหน้า (ใช้กับ viewScale)
    function fitWidth(){
      const padding = 40;
      const availW = viewer.clientWidth - padding;
      viewScale = availW / baseViewport.width;
      viewScale = Math.max(MIN, Math.min(MAX, viewScale));
      pageScaleEl.style.transform = `scale(${viewScale})`;
      showZoom();
    }

    // รีเรนเดอร์ทุกหน้าแบบคม ตาม renderScale ปัจจุบัน
    async function rerenderAllPages(){
      // ล้างลูก ๆ ของ pageScale แล้ววางใหม่
      pageScaleEl.innerHTML = '';
      const total = pdfDoc.numPages;
      const dpr = Math.min(window.devicePixelRatio || 1, 2);

      for(let n=1; n<=total; n++){
        const page = await pdfDoc.getPage(n);
        const vp = page.getViewport({ scale: renderScale, rotation: 0 });

        const wrap = document.createElement('div');
        wrap.className = 'my-5';
        const canvas = document.createElement('canvas');
        canvas.className = 'page-shadow bg-white mx-auto block';
        wrap.appendChild(canvas);
        pageScaleEl.appendChild(wrap);

        // ตั้งขนาด canvas จริง (คูณ dpr) + ขนาดที่ตาเห็น
        canvas.width  = Math.floor(vp.width  * dpr);
        canvas.height = Math.floor(vp.height * dpr);
        canvas.style.width  = Math.floor(vp.width)  + 'px';
        canvas.style.height = Math.floor(vp.height) + 'px';

        await page.render({
          canvasContext: canvas.getContext('2d'),
          viewport: vp,
          transform: dpr !== 1 ? [dpr,0,0,dpr,0,0] : null
        }).promise;
      }
    }

    // ซูมแบบลื่น: เปลี่ยน viewScale ทันที (CSS), จากนั้นหน่วงค่อยวาดจริง
    let rerenderTimer;
    function zoomTo(newScale){
      viewScale = Math.max(MIN, Math.min(MAX, newScale));
      pageScaleEl.style.transform = `scale(${viewScale})`;
      showZoom();

      // หน่วงสั้น ๆ แล้วค่อยวาดจริงให้คม (กำจัดหน่วงตอนกำลังหนีบ)
      clearTimeout(rerenderTimer);
      rerenderTimer = setTimeout(async ()=>{
        renderScale = viewScale;            // ยอมรับสเกลใหม่
        await rerenderAllPages();           // วาดคมทุกหน้า
        pageScaleEl.style.transform = `scale(${viewScale})`; // รักษาสเกลโชว์
      }, 120);
    }

    // ปรับซูมแบบคูณ/หาร (ใช้กับปุ่ม +/− และ wheel)
    const zoomBy = factor => zoomTo(viewScale * factor);

    // โหลด PDF แล้วแสดงทันที
    async function loadPdf(){
      wireFileButtons();

      const task = pdfjsLib.getDocument({
        url: PDF_FILE,
        disableAutoFetch: false,
        rangeChunkSize: 65536
      });
      task.onProgress = ({loaded,total})=>{
        if (total) progressBar.style.width = Math.min(100, Math.round(loaded/total*100))+'%';
      };

      try{
        pdfDoc = await task.promise;
      }catch(err){
        if (PDF_FILE === PDF_FILE_LOWER){ PDF_FILE = PDF_FILE_UPPER; wireFileButtons(); return loadPdf(); }
        throw err;
      }

      // อ่านหน้าแรกเพื่อรู้ขนาดจริง (บังคับ rotation:0)
      const first = await pdfDoc.getPage(1);
      baseViewport = first.getViewport({ scale: 1, rotation: 0 });

      // เริ่ม: ฟิตกว้างด้วย viewScale แล้วค่อยวาดจริงตามนั้น
      fitWidth();
      renderScale = viewScale;
      await rerenderAllPages();

      loadingMsg?.remove();
      setTimeout(()=>progressWrap.classList.add("hidden"), 300);
    }

    // ยิงโหลดเลย
    loadPdf().catch(err=>{
      progressWrap.classList.add('hidden');
      pageScaleEl.innerHTML = `<div class="p-6 text-red-700">
        ไม่สามารถเปิดไฟล์ได้: <b>${err.message}</b><br>
        ตรวจชื่อไฟล์ <code>${PDF_FILE}</code> ให้ตรงกับใน repo (คำนึงตัวพิมพ์เล็ก/ใหญ่)
      </div>`;
    });

    // ===== ปุ่ม/คีย์ลัด =====
    brandBtn.addEventListener('click', ()=>location.reload()); // คลิกชื่อ = รีหน้า
    zoomInBtn .addEventListener('click', ()=>zoomBy(1.1));
    zoomOutBtn.addEventListener('click', ()=>zoomBy(1/1.1));
    viewer.addEventListener('wheel', e=>{
      if (e.ctrlKey){ e.preventDefault(); zoomBy(e.deltaY<0 ? 1.08 : 1/1.08); }
    }, {passive:false});
    window.addEventListener('keydown', e=>{
      if ((e.ctrlKey||e.metaKey) && (e.key==='+'||e.key==='=')){ e.preventDefault(); zoomBy(1.1); }
      if ((e.ctrlKey||e.metaKey) &&  e.key==='-'){            e.preventDefault(); zoomBy(1/1.1); }
      if ((e.ctrlKey||e.metaKey) &&  e.key==='0'){            e.preventDefault(); fitWidth(); zoomTo(viewScale); }
    });

    // ===== Pinch-to-Zoom แบบนิ่มบนมือถือ/แท็บเล็ต =====
    // ทริค: จับเฉพาะ "สองนิ้ว" เท่านั้น, หนึ่งนิ้ว = ปัดเลื่อนตามปกติ (เราไม่ไปยุ่ง)
    const touches = new Map();
    let pinchBaseDist = null, pinchStartScale = null;

    const dist = (a,b)=>Math.hypot(a.x-b.x, a.y-b.y);

    viewer.addEventListener('pointerdown', e=>{
      // เก็บเฉพาะ pointer แบบ touch/pen ก็ได้ แต่ mouse ก็ไม่เป็นไร
      touches.set(e.pointerId, {x:e.clientX, y:e.clientY});
      // เริ่มจับ pointer เฉพาะตอนมี "สองนิ้ว" เพื่อไม่รบกวนการเลื่อนปกติ
      if (touches.size === 2) viewer.setPointerCapture(e.pointerId);
    }, {passive:true});

    viewer.addEventListener('pointermove', e=>{
      if (!touches.has(e.pointerId)) return;
      touches.set(e.pointerId, {x:e.clientX, y:e.clientY});

      if (touches.size === 2){
        const [a,b] = [...touches.values()];
        const d = dist(a,b);
        if (!pinchBaseDist){ pinchBaseDist = d; pinchStartScale = viewScale; }
        else {
          const factor = d / pinchBaseDist;
          const target = Math.max(MIN, Math.min(MAX, pinchStartScale * factor));
          // อัปเดตเฉพาะ CSS ให้ลื่นก่อน
          pageScaleEl.style.transform = `scale(${target})`;
          viewScale = target; showZoom();
        }
        // กันเบราว์เซอร์ซูมระบบ (สำคัญบน iOS)
        e.preventDefault();
      }
    }, {passive:false});

    function endPointer(e){
      if (touches.has(e.pointerId)) touches.delete(e.pointerId);
      if (touches.size < 2 && pinchBaseDist){ // จบ pinch → re-render ให้คม
        pinchBaseDist = null; pinchStartScale = null;
        zoomTo(viewScale); // ใช้ flow เดิม: หน่วงนิดแล้ววาดจริง
      }
    }
    viewer.addEventListener('pointerup', endPointer, {passive:true});
    viewer.addEventListener('pointercancel', endPointer, {passive:true});
    viewer.addEventListener('pointerleave', endPointer, {passive:true});

    // ===== รีไซส์จอ: คงความฟิตกว้างแบบสมเหตุสมผล =====
    let resizeTimer;
    window.addEventListener('resize', ()=>{
      if (!baseViewport) return;
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(()=>{
        const currentPct = viewScale; // จำซูมไว้
        fitWidth();                   // คำนวณใหม่ให้พอดีกว้าง
        // ถ้าผู้ใช้ซูมมือไว้มากกว่าฟิตกว้าง ก็รักษาสูงกว่าเดิมไว้
        viewScale = Math.max(viewScale, currentPct);
        pageScaleEl.style.transform = `scale(${viewScale})`;
        showZoom();
        // วาดคมตามสเกลปัจจุบัน
        zoomTo(viewScale);
      }, 150);
    });
  </script>

  <!-- No-JS fallback -->
  <noscript>
    <div class="max-w-3xl mx-auto my-6 p-4 bg-yellow-50 border border-yellow-300 rounded">
      ต้องเปิดใช้งาน JavaScript เพื่อดูตัวอ่าน PDF แบบโต้ตอบ
      <div>สำรอง: <a class="underline" href="resumeAkkaphonWorakleeb30551.pdf" target="_blank" rel="noopener">
        เปิดไฟล์ PDF ในแท็บใหม่</a></div>
    </div>
  </noscript>
</body>
</html>
