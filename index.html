<!doctype html> <!-- บอกเบราว์เซอร์ว่าเป็น HTML5 -->
<html lang="th"> <!-- ภาษาหลักเป็นไทย -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resume — Akkaraphon Worakleeb</title>

  <!-- คำอธิบายหลักของหน้า (จะใช้เป็นพรีวิวกรณีไม่มี OG) -->
  <meta name="description" content="เรซูเม่ Akkaraphon Worakleeb — ปี 3 Mathematics & Computer Science (KMUTNB) ">

  <!-- Canonical URL ของหน้า -->
  <link rel="canonical" href="https://akkaraphon88.github.io/30551DatacommuWebHosting/">

  <!-- Open Graph (ใช้กับ LINE/FB/Discord ฯลฯ) -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Resume — Akkaraphon Worakleeb">
  <meta property="og:url" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/">
  <meta property="og:title" content="Resume — Akkaraphon Worakleeb (KMUTNB)">
  <meta property="og:description" content="เรซูเม่ Akkaraphon Worakleeb คณิตศาสตร์เชิงวิทยาการคอมพิวเตอร์">
  <meta property="og:image" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/resumeAkkaphonWorakleeb30551.png">
  <meta property="og:image:alt" content="ภาพหน้าปกเรซูเม่ Akkaraphon Worakleeb">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Resume — Akkaraphon Worakleeb (KMUTNB)">
  <meta name="twitter:description" content="เรซูเม่ปี 3 คณิตศาสตร์เชิงวิทยาการคอมพิวเตอร์ | เปิดดู PDF ได้ทันที ซูมลื่น ดาวน์โหลด/พิมพ์ได้">
  <meta name="twitter:image" content="https://akkaraphon88.github.io/30551DatacommuWebHosting/resumeAkkaphonWorakleeb30551.png">

  <!-- โทนสี/ธีมเบราว์เซอร์ -->
  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#6b0f0f">

  <!-- favicon -->
  <link rel="icon" type="image/png" href="resumeAkkaphonWorakleeb30551.png">
  <link rel="apple-touch-icon" href="resumeAkkaphonWorakleeb30551.png">

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  </script>

  <style>
    .page-shadow { box-shadow: 0 10px 22px rgba(2, 6, 23, .12); border-radius: .6rem; }
    #viewer::-webkit-scrollbar{height:12px;width:12px}
    #viewer::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:999px}
    #viewer::-webkit-scrollbar-track{background:#e2e8f0}
  </style>
</head>

<body class="bg-slate-50 text-slate-800 antialiased selection:bg-rose-100"> <!-- พื้นหลังโทนอ่อน อ่านง่าย -->

  <!-- ===== แถบเครื่องมือด้านบน ===== -->
  <header class="sticky top-0 z-20 bg-white/95 backdrop-blur border-b border-slate-200"> <!-- ลอยติดบน -->
    <div class="max-w-6xl mx-auto px-3 sm:px-4 py-2.5 flex flex-wrap items-center gap-2"> <!-- กล่องภายใน -->
      <div class="flex items-center gap-2 mr-auto"> <!-- โลโก้ข้อความฝั่งซ้าย -->
        <div class="h-6 w-1.5 bg-rose-900 rounded"></div> <!-- แท่งสีเล็ก ๆ เท่ ๆ -->
        <div class="font-bold tracking-wide text-rose-900">Resume อัครพนธ์</div> <!-- ชื่อหัว -->
      </div>

      <!-- ปุ่มควบคุมการแสดงผล -->
      <button id="fitWidthBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">Fit Width</button> <!-- พอดีกว้าง -->
      <button id="fitPageBtn"  class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">Fit Page</button>  <!-- พอดีทั้งหน้า -->

      <span class="mx-1 w-px h-6 bg-slate-200"></span> <!-- เส้นแบ่ง -->

      <button id="zoomOutBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">−</button> <!-- ซูมออก -->
      <span id="zoomLabel" class="w-16 text-center font-semibold tabular-nums">100%</span> <!-- โชว์ % ซูม -->
      <button id="zoomInBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">+</button> <!-- ซูมเข้า -->

      <span class="mx-1 w-px h-6 bg-slate-200"></span> <!-- เส้นแบ่ง -->

      <!-- ปุ่มไฟล์ -->
      <a id="openBtn"     href="#" target="_blank" rel="noopener"
         class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">Open</a> <!-- เปิด PDF แท็บใหม่ -->
      <a id="downloadBtn" href="#" download
         class="px-3 py-1.5 rounded-lg bg-rose-900 text-white border border-rose-900 hover:bg-rose-800">Download</a> <!-- ดาวน์โหลด -->
      <a id="printBtn"    href="#" target="_blank" rel="noopener"
         class="px-3 py-1.5 rounded-lg border border-slate-300 hover:border-slate-400">Print</a> <!-- สั่งพิมพ์ -->
    </div>

    <!-- แถบสถานะโหลด PDF -->
    <div id="progressWrap" class="w-full h-1 bg-slate-200">
      <div id="progressBar" class="h-full w-0 bg-rose-900 transition-all duration-300"></div> <!-- กว้างขึ้นตามโหลด -->
    </div>
  </header>

  <!-- ===== พื้นที่แสดง PDF ===== -->
  <main class="max-w-6xl mx-auto px-3 sm:px-4"> <!-- กึ่งกลาง + จำกัดความกว้าง -->
    <section class="mt-4 bg-white border border-slate-200 rounded-xl overflow-hidden"> <!-- กรอบ viewer -->
      <div id="viewer" class="overflow-auto bg-slate-100 flex justify-center"
           style="height: calc(100vh - 128px); touch-action: pan-y;"> <!-- สูงพอดีจอ, เลื่อนแกน Y ได้ -->
        <div id="loadingMsg" class="p-6 text-slate-500">กำลังโหลดไฟล์ครับ...</div> <!-- ข้อความชั่วคราว -->
      </div>
    </section>

    <footer class="text-center text-slate-500 text-sm my-6">
      เว็บไซต์: <a class="underline" href="https://akkaraphon88.github.io/30551DatacommuWebHosting" target="_blank" rel="noopener">
        akkaraphon88.github.io/30551DatacommuWebHosting</a> <!-- ลิงก์ไปโฮมของงาน -->
    </footer>
  </main>

  <script>
    /********** โค้ดควบคุม PDF viewer (ภาษาบ้านๆ) **********
     * - ใช้ PDF.js อ่านไฟล์ PDF แล้ววาดลง <canvas> ทีละหน้า
     * - scale คือระดับซูม, มีปุ่ม Fit Width / Fit Page ให้พอดีตา
     * - บังคับ rotation: 0 เพื่อแก้เคสไฟล์กลับหัวจากต้นฉบับ
     *******************************************************/

    // 1) ตั้งชื่อไฟล์ PDF (อยู่โฟลเดอร์เดียวกับ index.html)
    const PDF_FILE_LOWER = "resumeAkkaphonWorakleeb30551.pdf"; // ตัวพิมพ์เล็ก
    const PDF_FILE_UPPER = "resumeAkkaphonWorakleeb30551.PDF"; // เผื่อบางทีอัปเป็น .PDF ใหญ่
    let PDF_FILE = PDF_FILE_LOWER; // เริ่มลองตัวพิมพ์เล็กก่อน

    // 2) ตัวแปรสถานะ
    let pdfDoc = null;     // ตัวเอกสาร PDF ทั้งเล่ม
    let scale = 1;         // ระดับซูม ณ ปัจจุบัน
    let baseViewport = null; // ขนาดหน้าแรกที่ scale=1 (ไว้คำนวณพอดีกว้าง/หน้า)
    let fitMode = "width"; // โหมดเริ่มต้น: พอดีกว้าง
    const renderedAtScale = new Map(); // จำว่า “หน้าไหนเคยวาดที่ scale เท่าไรแล้ว”

    // 3) จับ element ต่าง ๆ ที่จะใช้
    const viewer       = document.getElementById("viewer");
    const loadingMsg   = document.getElementById("loadingMsg");
    const progressWrap = document.getElementById("progressWrap");
    const progressBar  = document.getElementById("progressBar");
    const fitWidthBtn  = document.getElementById("fitWidthBtn");
    const fitPageBtn   = document.getElementById("fitPageBtn");
    const zoomInBtn    = document.getElementById("zoomInBtn");
    const zoomOutBtn   = document.getElementById("zoomOutBtn");
    const zoomLabel    = document.getElementById("zoomLabel");
    const openBtn      = document.getElementById("openBtn");
    const downloadBtn  = document.getElementById("downloadBtn");
    const printBtn     = document.getElementById("printBtn");

    // ให้ปุ่มไฟล์ชี้ไปที่ PDF ถูกตัว
    function wireFileButtons() {
      openBtn.href     = PDF_FILE;       // เปิดแท็บใหม่
      downloadBtn.href = PDF_FILE;       // ดาวน์โหลด
      printBtn.href    = PDF_FILE + "#print"; // เปิดแล้วสั่งพิมพ์ได้ง่าย
    }

    // อัปเดตตัวเลข % ซูมบน toolbar
    const updateZoomLabel = () => zoomLabel.textContent = Math.round(scale * 100) + "%";

    // คำนวณ “พอดีกว้าง”
    function fitWidth() {
      const padding = 40;                              // เผื่อขอบหน่อย
      const availableW = viewer.clientWidth - padding; // พื้นที่กว้างที่มี
      scale = availableW / baseViewport.width;         // คำนวณสเกลให้พอดี
      fitMode = "width"; updateZoomLabel();            // เซ็ตโหมด + อัปเดตตัวเลข
    }
    // คำนวณ “พอดีทั้งหน้า”
    function fitPage() {
      const padding = 40;
      const availableW = viewer.clientWidth  - padding;
      const availableH = viewer.clientHeight - padding;
      const s1 = availableW / baseViewport.width;      // สเกลตามความกว้าง
      const s2 = availableH / baseViewport.height;     // สเกลตามความสูง
      scale = Math.min(s1, s2);                         // เอาค่าที่เล็กกว่า = พอดีทั้งหน้า
      fitMode = "page"; updateZoomLabel();
    }

    // ซูมเข้า/ออกแบบลื่น (จำกัดช่วง 40%–400%)
    function zoomBy(factor) {
      fitMode = "free";                                 // ถือว่าเป็นโหมดอิสระ
      const newScale = Math.min(4, Math.max(0.4, scale * factor));
      if (Math.abs(newScale - scale) < 0.02) return;    // ต่างนิดเดียวไม่ต้องวาดใหม่
      scale = newScale; updateZoomLabel();
      renderedAtScale.clear(); renderVisiblePages();    // ล้าง cache แล้ววาดหน้าในจอใหม่
      viewer.scrollTo({ top: 0, behavior: "instant" }); // เลื่อนขึ้นบนสุดกันงง
    }

    // วาง placeholder ของทุกหน้า (จริง ๆ เรซูเม่มีหน้าเดียว แต่รองรับหลายหน้าไว้ก่อน)
    function buildPlaceholders() {
      viewer.innerHTML = "";                // เคลียร์ของเดิม
      const total = pdfDoc.numPages;        // จำนวนหน้า
      for (let n = 1; n <= total; n++) {    // สร้าง div+canvas ต่อหน้า
        const wrap = document.createElement("div");
        wrap.className = "my-5";
        wrap.dataset.page = n;

        const canvas = document.createElement("canvas");
        canvas.className = "page-shadow bg-white mx-auto block"; // ให้ดูเป็นแผ่นกระดาษ
        wrap.appendChild(canvas);

        viewer.appendChild(wrap);
      }
    }

    // วาด 1 หน้าให้ “คม” และ “แก้กลับหัว” โดยบังคับ rotation: 0
    async function renderOnePage(pageNum) {
      const dpr = Math.min(window.devicePixelRatio || 1, 2); // คุม dpr สูงสุด 2 กันช็อต
      if (renderedAtScale.get(pageNum) === scale) return;    // เคยวาดสเกลนี้แล้ว ข้าม

      const page = await pdfDoc.getPage(pageNum);            // ดึงหน้าที่ต้องการ
      const viewport = page.getViewport({ scale, rotation: 0 }); // **ตรงนี้แหละแก้กลับหัว**

      const holder = viewer.querySelector(`[data-page="${pageNum}"]`);
      const canvas = holder.querySelector("canvas");
      const ctx    = canvas.getContext("2d");

      // ขนาดจริงของ canvas (คูณ dpr เพื่อคมกริบ)
      canvas.width  = Math.floor(viewport.width  * dpr);
      canvas.height = Math.floor(viewport.height * dpr);
      // ขนาดที่มองเห็นบนจอ (CSS pixel)
      canvas.style.width  = Math.floor(viewport.width)  + "px";
      canvas.style.height = Math.floor(viewport.height) + "px";

      // ส่งงานให้ PDF.js จัดการเรนเดอร์ลง canvas
      const renderContext = {
        canvasContext: ctx,
        viewport,
        transform: dpr !== 1 ? [dpr, 0, 0, dpr, 0, 0] : null // ชดเชย dpr
      };
      await page.render(renderContext).promise;   // รอวาดเสร็จ
      renderedAtScale.set(pageNum, scale);        // จำว่าเคยวาดแล้วที่สเกลนี้
    }

    // วาดเฉพาะหน้าที่กำลังอยู่ในจอ (ประหยัดแรง)
    function renderVisiblePages() {
      document.querySelectorAll('#viewer [data-page]').forEach(el => {
        const r = el.getBoundingClientRect(), root = viewer.getBoundingClientRect();
        const visible = r.bottom > root.top && r.top < root.bottom; // ตัดสินว่า “โผล่ในจอ” ไหม
        if (visible) renderOnePage(Number(el.dataset.page));
      });
    }

    // โหลด PDF + fallback (.pdf -> .PDF) แล้วแสดงเลย
    async function loadPdfWithFallback() {
      wireFileButtons(); // ให้ปุ่มไฟล์ทำงานกับชื่อไฟล์ปัจจุบัน

      const loadingTask = pdfjsLib.getDocument({
        url: PDF_FILE,
        disableAutoFetch: false,
        rangeChunkSize: 65536 // โหลดเป็นก้อน ๆ เพื่อให้แถบ progress วิ่ง滑 ๆ
      });

      // ขยับ progress bar ระหว่างโหลด
      loadingTask.onProgress = ({ loaded, total }) => {
        if (total) progressBar.style.width = Math.min(100, Math.round(loaded / total * 100)) + "%";
      };

      try {
        pdfDoc = await loadingTask.promise; // พอโหลดเสร็จ ได้เอกสาร PDF
      } catch (err) {
        // ถ้าเวอร์ชัน .pdf ไม่เจอ ลอง .PDF ให้อัตโนมัติ
        if (PDF_FILE === PDF_FILE_LOWER) {
          PDF_FILE = PDF_FILE_UPPER; wireFileButtons(); return loadPdfWithFallback();
        }
        throw err; // อื่น ๆ ก็แจ้ง error ไป
      }

      // อ่านหน้าแรกเพื่อรู้ “ขนาดจริง” (scale=1) และเราบังคับ rotation:0 เช่นกัน
      const first = await pdfDoc.getPage(1);
      baseViewport = first.getViewport({ scale: 1, rotation: 0 });

      // สร้างโครงหน้า + เริ่มแบบพอดีกว้าง
      buildPlaceholders();
      fitWidth();
      renderVisiblePages();

      // ซ่อน UI โหลด
      loadingMsg?.remove();
      setTimeout(() => progressWrap.classList.add("hidden"), 400);
    }

    // เรียกโหลดเลย (เปิดเว็บปุ๊บเห็นทันที)
    loadPdfWithFallback().catch(err => {
      progressWrap.classList.add("hidden");
      viewer.innerHTML = `<div class="p-6 text-red-700">
        ไม่สามารถเปิดไฟล์ได้: <span class="font-semibold">${err.message}</span><br>
        ตรวจชื่อไฟล์ <code>${PDF_FILE}</code> ให้ตรงกับใน repo (ตัวพิมพ์เล็ก/ใหญ่ต้องตรง)</div>`;
    });

    // ===== ปุ่ม/คีย์ลัดพื้นฐาน =====
    fitWidthBtn.addEventListener("click", () => { fitWidth(); renderedAtScale.clear(); renderVisiblePages(); });
    fitPageBtn .addEventListener("click", () => { fitPage();  renderedAtScale.clear(); renderVisiblePages(); });
    zoomInBtn  .addEventListener("click", () => zoomBy(1.1));     // ซูมเข้า
    zoomOutBtn .addEventListener("click", () => zoomBy(1/1.1));   // ซูมออก

    // ซูมด้วย Ctrl + ล้อเมาส์ (ฟีลโปร)
    viewer.addEventListener("wheel", (e) => {
      if (e.ctrlKey) { e.preventDefault(); zoomBy(e.deltaY < 0 ? 1.08 : 1/1.08); }
    }, { passive: false });

    // รีไซส์หน้าจอ: ถ้าอยู่โหมด fit ให้คงความพอดีไว้
    let resizeTimer;
    window.addEventListener("resize", () => {
      if (!baseViewport) return;
      if (fitMode !== "free") {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          (fitMode === "width" ? fitWidth : fitPage)();
          renderedAtScale.clear(); renderVisiblePages();
        }, 120);
      }
    });
  </script>

  <noscript> <!-- เผื่อคนปิด JavaScript -->
    <div class="max-w-3xl mx-auto my-6 p-4 bg-yellow-50 border border-yellow-300 rounded">
      ต้องเปิดใช้งาน JavaScript เพื่อดูตัวอ่าน PDF แบบโต้ตอบ
      <div>สำรอง: <a class="underline" href="resumeAkkaphonWorakleeb30551.pdf" target="_blank" rel="noopener">
        เปิดไฟล์ PDF ในแท็บใหม่</a></div>
    </div>
  </noscript>
</body>
</html>
